<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GUDEX - Panel de Administraci칩n</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    
    <header class="admin-header">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <img src="LOGO GUDEX ROJO SIN FONDO.png" alt="Logo GUDEX" class="logo-admin">
            <h2>Panel de Administraci칩n</h2>
        </div>
        
        <div class="header-right">
            <div id="reloj-sistema" class="reloj-sistema">Cargando...</div>
            <button id="logout-button" class="btn-logout">
                <i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesi칩n
            </button>
        </div>
    </header>

    <div class="admin-layout">
        
        <nav class="sidebar">
            <ul class="sidebar-nav">
                <li>
                    <a href="#" class="nav-link active" data-view="citas">
                        <div class="nav-content"><i class="fa-solid fa-calendar-check"></i> <span>Dashboard</span></div>
                    </a>
                </li>

                <li class="nav-group">
                    <a href="#" class="nav-toggle">
                        <div class="nav-content"><i class="fa-solid fa-briefcase"></i> <span>Operaciones</span></div>
                        <i class="fa-solid fa-chevron-right arrow-icon"></i>
                    </a>
                    <ul class="sub-menu">
                        <li><a href="#" class="nav-link" data-view="buscador">Buscador Patente</a></li>
                        <li><a href="#" class="nav-link" data-view="mantenciones">Gesti칩n Mantenciones</a></li>
                        <li><a href="#" class="nav-link" data-view="clientes">Gesti칩n Clientes</a></li>
                    </ul>
                </li>

                <li class="nav-group">
                    <a href="#" class="nav-toggle">
                        <div class="nav-content"><i class="fa-solid fa-boxes-stacked"></i> <span>Inventario</span></div>
                        <i class="fa-solid fa-chevron-right arrow-icon"></i>
                    </a>
                    <ul class="sub-menu">
                        <li><a href="#" class="nav-link" data-view="inventario">Productos y Stock</a></li>
                        <li><a href="#" class="nav-link" data-view="toma-inventario">游님 Toma Inventario</a></li> <li><a href="#" class="nav-link" data-view="servicios">Cat치logo Servicios</a></li>
                        <li><a href="#" class="nav-link" data-view="config-categorias">Categor칤as</a></li>
                    </ul>
                </li>

                <li class="nav-group">
                    <a href="#" class="nav-toggle">
                        <div class="nav-content"><i class="fa-solid fa-gears"></i> <span>Administraci칩n</span></div>
                        <i class="fa-solid fa-chevron-right arrow-icon"></i>
                    </a>
                    <ul class="sub-menu">
                        <li><a href="#" class="nav-link" data-view="config-vehiculos">Marcas y Modelos</a></li>
                        <li><a href="#" class="nav-link" data-view="estadisticas">Estad칤sticas</a></li>
                        <li><a href="#" class="nav-link" data-view="sistema">Sistema y Respaldos</a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <main class="main-content">

            <div id="view-citas" class="content-view active">
                <div class="dashboard-grid">
                    <div class="card"><h3><span class="status-dot status-pendiente"></span>Pendientes</h3><ul id="lista-citas-pendientes-ul" class="lista-citas"><li>Cargando...</li></ul></div>
                    <div class="card"><h3><span class="status-dot status-confirmada"></span>Confirmadas</h3><ul id="lista-citas-confirmadas-ul" class="lista-citas"><li>Cargando...</li></ul></div>
                    <div class="card"><h3><span class="status-dot status-terminada"></span>Terminadas (Hoy)</h3><ul id="lista-citas-terminadas-ul" class="lista-citas"><li>Cargando...</li></ul></div>
                </div>
            </div>

            <div id="view-buscador" class="content-view">
                <div class="card admin-form"><h3><i class="fa-solid fa-magnifying-glass"></i> Buscar Veh칤culo</h3><form id="form-buscador-patente"><div style="display: flex; gap: 10px;"><input type="text" id="busqueda-patente" placeholder="Ej: ABCD12" required style="text-transform: uppercase; font-weight: bold;"><button type="submit" style="margin-top: 0;">Buscar</button></div></form></div>
                <div id="resultado-busqueda" class="hidden"><div class="card"><div style="display: flex; justify-content: space-between; align-items: center;"><h3>Ficha del Veh칤culo</h3><button id="btn-ir-cliente" class="btn-edit" style="width: auto; margin: 0;">Gestionar Cliente</button></div><hr><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;"><div><p><strong>Patente:</strong> <span id="res-patente" style="color: var(--primary); font-weight: bold;"></span></p><p><strong>Veh칤culo:</strong> <span id="res-marca-modelo"></span></p><p><strong>A침o:</strong> <span id="res-anio"></span></p></div><div><p><strong>Due침o:</strong> <span id="res-cliente"></span></p><p><strong>Email:</strong> <span id="res-email"></span></p><p><strong>Tel칠fono:</strong> <span id="res-telefono"></span></p></div></div></div><div class="card"><h3>Historial</h3><ul id="res-lista-historial" class="lista-citas"></ul></div></div>
            </div>

            <div id="view-mantenciones" class="content-view">
                <div class="card"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;"><h2><i class="fa-solid fa-list"></i> Buscador de Mantenciones</h2><button onclick="window.promptNuevaMantencion()" class="btn-confirmar" style="margin:0;"><i class="fa-solid fa-plus"></i> Nueva</button></div><div class="admin-form" style="margin-bottom: 2rem;"><form id="form-buscador-mantenciones"><label>Filtrar por: Patente, Cliente o Fecha (DD-MM-AAAA)</label><div style="display: flex; gap: 10px;"><input type="text" id="input-buscar-mantencion" placeholder="Buscar..."><button type="submit" style="margin: 0;">Buscar</button></div></form></div><div class="table-responsive"><table class="historial" style="width:100%"><thead><tr><th>Fecha</th><th>Veh칤culo</th><th>Cliente</th><th>Trabajos</th><th>Acciones</th></tr></thead><tbody id="tbody-mantenciones"><tr><td colspan="5" style="text-align:center;">Cargando...</td></tr></tbody></table></div></div>
            </div>

            <div id="view-clientes" class="content-view">
                <div class="admin-container-clientes">
                    <section class="admin-column"><div class="card admin-form"><h3><i class="fa-solid fa-user-plus"></i> Registrar Cliente</h3><form id="form-crear-cliente"><input id="admin-nombre" placeholder="Nombre Completo" required><input id="admin-email" placeholder="Email" required type="email"><input id="admin-password" type="password" placeholder="Contrase침a" required><input id="admin-telefono" placeholder="Tel칠fono"><select id="admin-role"><option value="cliente">Cliente</option><option value="admin">Admin</option></select><button type="submit">Crear</button></form></div><div class="card"><h3><i class="fa-solid fa-users"></i> Clientes</h3><ul id="lista-clientes-ul"><li>Cargando...</li></ul></div></section>
                    <section class="admin-column hidden" id="columna-detalles"><div class="card"><div style="display: flex; justify-content: space-between; align-items: center;"><h3 id="detalle-cliente-nombre">Cliente</h3><button id="btn-pdf-cliente" class="btn-descargar" style="margin:0; font-size:0.8rem; padding: 0.4rem;"><i class="fa-solid fa-file-pdf"></i> PDF</button></div><p id="detalle-cliente-info"></p></div><div class="card admin-form"><h3><i class="fa-solid fa-car"></i> Nuevo Veh칤culo</h3><form id="form-agregar-vehiculo"><input id="admin-patente" placeholder="Patente" required style="text-transform: uppercase;"><select id="admin-marca" required><option>Marca</option></select><select id="admin-modelo" required><option>Modelo</option></select><input id="admin-anio" type="number" placeholder="A침o"><button type="submit">Agregar</button></form></div><div class="card"><h3>Veh칤culos del Cliente</h3><ul id="lista-vehiculos-ul"></ul></div><div class="card admin-form" style="border: 2px solid var(--info);"><h3 style="color: var(--info);"><i class="fa-solid fa-calendar-plus"></i> Agendar Cita</h3><form id="form-admin-agendar-cita"><input type="date" id="admin-cita-fecha" required><select id="admin-cita-hora" required><option value="">-- Hora --</option><option value="09:00">09:00</option><option value="10:00">10:00</option><option value="11:00">11:00</option><option value="12:00">12:00</option><option value="13:00">13:00</option><option value="14:00">14:00</option><option value="15:00">15:00</option><option value="16:00">16:00</option><option value="17:00">17:00</option></select><input id="admin-cita-servicio" placeholder="Motivo" required><button type="submit" style="background-color: var(--info);">Agendar</button></form></div><div class="card admin-form"><h3><i class="fa-solid fa-wrench"></i> Registrar Mantenimiento</h3><form id="form-agregar-mantenimiento"><label>Fecha y KM:</label><div style="display:flex; gap:10px;"><input type="date" id="admin-mantenimiento-fecha" required><input type="number" id="admin-mantenimiento-km" placeholder="KM Actual"></div><label>Resumen Trabajo:</label><textarea id="admin-mantenimiento-trabajos" rows="2" required></textarea><div style="background:#f8f9fa; padding:1rem; border-radius:8px; border:1px solid #eee; margin-bottom:10px;"><label><i class="fa-solid fa-barcode"></i> Agregar (Escanear/Buscar):</label><input type="text" id="input-scan-barcode" placeholder="Escanea c칩digo..." style="margin-bottom:5px; border:2px solid var(--info);"><div style="display:flex; gap:5px; margin-bottom:10px;"><select id="select-producto-mantencion" style="flex:2;"><option value="">Buscar manual...</option></select><input type="number" id="cant-producto-mantencion" value="1" min="1" style="width:70px;"><button type="button" id="btn-add-producto" class="btn-confirmar" style="margin:0;">+</button></div><ul id="lista-productos-agregados" class="config-list" style="max-height:150px;"></ul></div><label>Repuestos Externos:</label><textarea id="admin-mantenimiento-repuestos" rows="1"></textarea><label>Sugerencia:</label><textarea id="admin-mantenimiento-sugerencia" rows="1"></textarea><label>Pr칩ximo KM:</label><input type="number" id="admin-mantenimiento-prox-km"><div style="background:#e8f5e9; padding:10px; border-radius:6px; display:flex; align-items:center; gap:10px; border:1px solid #c8e6c9;"><input type="checkbox" id="imprimir-ticket" style="width:auto; margin:0;"><label for="imprimir-ticket" style="margin:0; color:#2e7d32; font-weight:bold; cursor:pointer;"><i class="fa-solid fa-print"></i> Imprimir Ticket</label></div><button type="submit">Registrar y Descontar</button></form></div><div class="card"><h3>Historial</h3><ul id="lista-historial-ul"></ul></div></section>
                </div>
            </div>

            <div id="view-inventario" class="content-view">
                <div class="admin-container-clientes">
                    <section class="admin-column">
                        <div class="card admin-form"><h3><i class="fa-solid fa-truck"></i> Nuevo Proveedor</h3><form id="form-crear-proveedor"><input id="prov-nombre" placeholder="Nombre Empresa" required><input id="prov-rut" placeholder="RUT"><input id="prov-telefono" placeholder="Tel칠fono"><input id="prov-email" placeholder="Email"><button>Guardar Proveedor</button></form></div>
                        <div class="card"><h3>Proveedores</h3><ul id="lista-proveedores" class="config-list"></ul></div>
                    </section>
                    <section class="admin-column" style="flex:2;">
                        <div class="card admin-form"><h3><i class="fa-solid fa-boxes-stacked"></i> Nuevo Producto</h3><form id="form-crear-producto"><div style="display:flex; gap:10px;"><input id="prod-barcode" placeholder="C칩d. Barras"><input id="prod-codigo" placeholder="SKU Interno"></div><input id="prod-nombre" placeholder="Nombre Producto" required><div style="display:flex; gap:10px;"><select id="prod-cat-padre"><option value="">Categor칤a</option></select><select id="prod-cat-hija"><option value="">Subcategor칤a</option></select></div><label>Proveedor:</label><select id="prod-proveedor"></select><div style="display:flex; gap:10px;"><input id="prod-costo" type="number" placeholder="Costo"><input id="prod-precio" type="number" placeholder="Venta"><input id="prod-stock" type="number" placeholder="Stock"></div><button>Guardar Producto</button></form></div>
                        <div class="card"><h3>Inventario Actual</h3><div class="table-responsive"><table class="historial" style="width:100%"><thead><tr><th>Bar</th><th>Nombre</th><th>Cat</th><th>Stk</th><th>$</th><th>Acci칩n</th></tr></thead><tbody id="tbody-inventario"></tbody></table></div></div>
                    </section>
                </div>
            </div>

            <div id="view-toma-inventario" class="content-view">
                <div class="card" style="max-width: 600px; margin: 0 auto; border: 2px solid var(--info);">
                    <h2 style="text-align: center; color: var(--info);"><i class="fa-solid fa-barcode"></i> Escanear Producto</h2>
                    <div class="admin-form">
                        <form id="form-scanner-inventario">
                            <input type="text" id="scanner-input" placeholder="Haz clic y escanea..." style="font-size: 1.5rem; text-align: center; padding: 1rem;" autocomplete="off">
                        </form>
                    </div>
                    <hr style="margin: 2rem 0;">
                    <div id="panel-existente" class="hidden" style="background: #e8f5e9; padding: 1.5rem; border-radius: 8px;">
                        <h3 style="color: #2e7d32;">Encontrado</h3>
                        <h2 id="scan-nombre"></h2>
                        <p>Stock Actual: <strong id="scan-stock-actual"></strong></p>
                        <form id="form-update-stock">
                            <input type="hidden" id="scan-id">
                            <label>Nuevo Stock Real:</label>
                            <input type="number" id="scan-nuevo-stock" style="font-size: 1.5rem; text-align: center;">
                            <button type="submit" style="background-color: #2e7d32;">Actualizar</button>
                        </form>
                    </div>
                    <div id="panel-nuevo" class="hidden" style="background: #fff3cd; padding: 1.5rem; border-radius: 8px;">
                        <h3 style="color: #856404;">Producto Nuevo</h3>
                        <p>C칩digo: <strong id="scan-new-code"></strong></p>
                        <form id="form-crear-scan">
                            <input type="hidden" id="new-scan-code">
                            <input id="new-scan-nombre" placeholder="Nombre" required>
                            <select id="new-scan-cat" required><option>Repuesto</option><option>Insumo</option></select>
                            <div style="display:flex; gap:10px;"><input id="new-scan-costo" type="number" placeholder="Costo"><input id="new-scan-precio" type="number" placeholder="Venta"></div>
                            <input id="new-scan-stock" type="number" placeholder="Stock Inicial" required>
                            <button type="submit" style="background-color: #856404;">Crear</button>
                        </form>
                    </div>
                </div>
            </div>

            <div id="view-servicios" class="content-view"><div class="admin-container-clientes"><section class="admin-column"><div class="card admin-form"><h3><i class="fa-solid fa-screwdriver-wrench"></i> Nuevo Servicio</h3><form id="form-crear-servicio"><input id="serv-nombre" placeholder="Nombre del Servicio" required><div style="display:flex; gap:10px;"><select id="serv-cat-padre"><option value="">Categor칤a</option></select><select id="serv-cat-hija"><option value="">Subcategor칤a</option></select></div><input id="serv-precio" type="number" placeholder="Precio Estimado"><button>Guardar Servicio</button></form></div></section><section class="admin-column" style="flex:2;"><div class="card"><h3>Cat치logo de Servicios</h3><div class="table-responsive"><table class="historial" style="width:100%"><thead><tr><th>Servicio</th><th>Cat</th><th>Precio</th><th>Acci칩n</th></tr></thead><tbody id="tbody-servicios"></tbody></table></div></div></section></div></div>

            <div id="view-config-categorias" class="content-view"><div class="admin-container-clientes"><section class="admin-column"><div class="card admin-form"><h3><i class="fa-solid fa-folder-plus"></i> Categor칤a Padre</h3><form id="form-crear-cat-padre"><input id="cat-padre-nombre" required placeholder="Ej: Motor"><button>Crear</button></form></div><div class="card"><h3>Categor칤as Principales</h3><ul id="lista-cat-padres" class="config-list"></ul></div></section><section class="admin-column"><div class="card"><h3><i class="fa-solid fa-folder-tree"></i> Subcategor칤as</h3><div id="panel-cat-hijos" class="hidden"><div class="admin-form" style="margin-bottom:1rem;"><form id="form-crear-cat-hija"><input id="cat-hija-nombre" required placeholder="Ej: Filtros"><button>A침adir</button></form></div><ul id="lista-cat-hijos" class="config-list"></ul></div><p id="info-cat-hijos" style="color:#666; font-style:italic;">&larr; Selecciona una categor칤a padre.</p></div></section></div></div>

            <div id="view-config-vehiculos" class="content-view"><div class="admin-container-clientes"><section class="admin-column"><div class="card admin-form"><h3><i class="fa-solid fa-car-side"></i> Agregar Marca</h3><form id="form-crear-marca"><div style="display:flex; gap:10px;"><input type="text" id="nueva-marca-nombre" required placeholder="Ej: Fiat"><button type="submit" style="margin-top: 0;">Crear</button></div></form></div><div class="card"><h3>Marcas</h3><ul id="lista-config-marcas" class="config-list"><li>Cargando...</li></ul></div></section><section class="admin-column"><div class="card"><h3 id="titulo-modelos-marca">Modelos</h3><div id="panel-modelos" class="hidden"><div class="admin-form" style="margin-bottom: 1rem; padding: 1rem; background: #f8f9fa;"><form id="form-crear-modelo"><label>Nuevo Modelo:</label><div style="display: flex; gap: 10px;"><input type="text" id="nuevo-modelo-nombre" required placeholder="Ej: Palio"><button type="submit" style="margin-top: 0; background-color: var(--info);">A침adir</button></div></form></div><ul id="lista-config-modelos" class="config-list"></ul></div><p id="info-modelos-marca" style="color:#666; font-style:italic;">&larr; Selecciona una marca.</p></div></section></div></div>

            <div id="view-estadisticas" class="content-view"><div class="card"><h2><i class="fa-solid fa-chart-pie"></i> Estad칤sticas</h2><div class="stats-grid"><div class="stat-container"><h3>Top 5 Marcas</h3><div id="chart-marcas-top" class="chart-container"></div></div><div class="stat-container"><h3>Top 5 Modelos</h3><div id="chart-modelos-top" class="chart-container"></div></div></div></div></div>

            <div id="view-sistema" class="content-view"><div class="dashboard-grid"><div class="card admin-form"><h3>Respaldo BD</h3><form id="form-backup-restore"><button type="button" id="btn-descargar-backup" class="btn-descargar">Descargar</button><hr class="form-hr"><label>Restaurar:</label><input type="file" id="backup-file" accept=".db"><button type="submit" id="btn-restaurar-backup" class="btn-delete">Restaurar</button></form></div><div class="card admin-form"><h3>Carga Masiva</h3><form id="form-excel-restore"><button type="button" id="btn-descargar-excel">Plantilla Clientes</button><hr class="form-hr"><label>Subir:</label><input type="file" id="excel-file" accept=".xls,.xlsx"><button type="submit" id="btn-restaurar-excel" class="btn-subir-excel">Procesar</button></form></div><div class="card admin-form"><h3>Carga Veh칤culos</h3><form id="form-excel-vehiculos"><button type="button" id="btn-descargar-excel-vehiculos">Plantilla Veh칤culos</button><hr class="form-hr"><label>Subir:</label><input type="file" id="excel-file-vehiculos" accept=".xls,.xlsx"><button type="submit" id="btn-restaurar-excel-vehiculos" class="btn-subir-excel">Procesar</button></form></div><div class="card admin-form"><h3>Carga Inventario</h3><form id="form-excel-productos"><button type="button" id="btn-descargar-excel-productos">Plantilla Productos</button><hr class="form-hr"><label>Subir:</label><input type="file" id="excel-file-productos" accept=".xls,.xlsx"><button type="submit" id="btn-restaurar-excel-productos" class="btn-subir-excel">Procesar</button></form></div></div></div>

        </main>
    </div>

    <div id="modal-overlay" class="modal-overlay"></div>
    <div id="cliente-modal" class="modal"><div class="modal-content"><span class="close-btn" id="close-cliente-modal">&times;</span><h2>Editar Cliente</h2><form id="form-edit-cliente" class="admin-form"><input type="hidden" id="edit-cliente-id"><label>Nombre:</label><input type="text" id="edit-cliente-nombre" required><label>Email:</label><input type="email" id="edit-cliente-email" required><label>Tel칠fono:</label><input type="tel" id="edit-cliente-telefono"><label>Rol:</label><select id="edit-cliente-role"><option value="cliente">Cliente</option><option value="admin">Admin</option></select><button type="submit">Guardar</button></form></div></div>
    <div id="vehiculo-modal" class="modal"><div class="modal-content"><span class="close-btn" id="close-vehiculo-modal">&times;</span><h2>Editar Veh칤culo</h2><form id="form-edit-vehiculo" class="admin-form"><input type="hidden" id="edit-vehiculo-id"><label>Patente:</label><input type="text" id="edit-vehiculo-patente" required><label>Marca:</label><input type="text" id="edit-vehiculo-marca"><label>Modelo:</label><input type="text" id="edit-vehiculo-modelo"><label>A침o:</label><input type="number" id="edit-vehiculo-anio"><button type="submit">Guardar</button></form></div></div>
    <div id="mantenimiento-modal" class="modal"><div class="modal-content"><span class="close-btn" id="close-mantenimiento-modal">&times;</span><h2>Editar Mantenimiento</h2><form id="form-edit-mantenimiento" class="admin-form"><input type="hidden" id="edit-mantenimiento-id"><label>Fecha:</label><input type="date" id="edit-mantenimiento-fecha" required><label>KM:</label><input type="number" id="edit-mantenimiento-km"><label>Trabajos:</label><textarea id="edit-mantenimiento-trabajos" rows="3"></textarea><label>Repuestos:</label><textarea id="edit-mantenimiento-repuestos" rows="2"></textarea><label>Sugerencia:</label><textarea id="edit-mantenimiento-sugerencia" rows="2"></textarea><label>Pr칩ximo KM:</label><input type="number" id="edit-mantenimiento-prox-km"><button type="submit">Guardar</button></form></div></div>
    <div id="quick-mantencion-modal" class="modal"><div class="modal-content"><span class="close-btn" id="close-quick-modal">&times;</span><h2>Nueva Mantenci칩n R치pida</h2><p>Ingresa la patente para continuar:</p><form id="form-quick-mantencion" class="admin-form"><input type="text" id="quick-patente" placeholder="PATENTE" required style="text-transform: uppercase; font-size: 1.5rem; text-align: center; letter-spacing: 2px;"><button type="submit">Buscar y Cargar</button></form></div></div>

    <script src="admin.js"></script>
</body>
</html>
